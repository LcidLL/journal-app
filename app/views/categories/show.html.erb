<div class="page-header">
  <h1><%= @category.category_name %></h1>
  <div class="page-actions">
    <%= link_to "Edit", edit_category_path(@category), class: "btn btn-secondary" %>
    <%= link_to "Delete", @category, 
        data: { 
          turbo_method: :delete, 
          turbo_confirm: "Are you sure? This will delete the tasks in this category." 
        }, 
        class: "btn btn-danger" %>
  </div>
</div>

<% if @category.description.present? %>
  <div class="section">
    <p><%= simple_format(@category.description) %></p>
  </div>
<% end %>

<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-number"><%= @tasks.count %></div>
    <div class="stat-label">Total Tasks</div>
  </div>
  <div class="stat-card">
    <div class="stat-number"><%= @completed_tasks.count %></div>
    <div class="stat-label">Completed</div>
  </div>
  <div class="stat-card">
    <div class="stat-number"><%= @priority_tasks.count %></div>
    <div class="stat-label">Priority</div>
  </div>
  <div class="stat-card">
    <div class="stat-number"><%= @overdue_tasks.count %></div>
    <div class="stat-label">Overdue</div>
  </div>
</div>

<div class="btn-group">
  <%= link_to "Back to Journal", categories_path, class: "btn btn-primary" %>
</div>

<br>

<div class="section">
  <div class="section-header">
    <h2>Tasks</h2>
    <% if @tasks.any? %>
      <%= link_to "Add Task", new_category_task_path(@category), class: "btn btn-primary btn-sm" %>
    <% end %>
  </div>

  <% if @tasks.any? %>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Task Name</th>
            <th>Description</th>
            <th>Due Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @tasks.each do |task| %>
            <tr class="<%= 'overdue-row' if task.overdue? %><%= 'due-today-row' if task.due_today? %><%= 'completed-row' if task.status == 'completed' %>">
              <td><%= link_to task.task_name, [@category, task] %></td>
              <td><%= truncate(task.description, length: 50) if task.description.present? %></td>
              <td>
                <%= task.due_date.strftime("%B %d, %Y") if task.due_date.present? %>
                <% if task.overdue? %>
                  <span class="badge badge-danger">Overdue</span>
                <% elsif task.due_today? %>
                  <span class="badge badge-warning">Due Today</span>
                <% end %>
              </td>
              <td>
                <% if task.status == 'completed' %>
                  <span class="badge badge-success"><%= task.status.humanize %></span>
                <% elsif task.status == 'in_progress' %>
                  <span class="badge badge-warning"><%= task.status.humanize %></span>
                <% elsif task.status == 'priority' %>
                  <span class="badge badge-info"><%= task.status.humanize %></span>
                <% else %>
                  <span class="badge"><%= task.status.humanize %></span>
                <% end %>
              </td>
              <td class="table-actions">
                <%= link_to "View", [@category, task], class: "btn btn-sm" %>
                <%= link_to "Edit", edit_category_task_path(@category, task), class: "btn btn-sm" %>
                <%= link_to "Delete", [@category, task], 
                  data: { 
                    turbo_method: :delete, 
                    turbo_confirm: "Are you sure?" 
                  }, 
                  class: "btn btn-sm btn-danger" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="empty-state">
      <h3>No tasks yet</h3>
      <p>Add your first task to get started.</p>
      <%= link_to "Add First Task", new_category_task_path(@category), class: "btn btn-primary" %>
    </div>
  <% end %>
</div>