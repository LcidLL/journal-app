<div class="tasks-container">
  <div class="page-header">
    <h1>üìã All Reading Tasks</h1>
    <div class="header-actions">
      <%= link_to "Dashboard", root_path, class: "btn btn-secondary" %>
      <%= link_to "My Library", books_path, class: "btn btn-info" %>
    </div>
  </div>

  <div class="tasks-summary">
    <div class="summary-cards">
      <div class="summary-card">
        <h3><%= @tasks.count %></h3>
        <p>Total Tasks</p>
      </div>
      <div class="summary-card">
        <h3><%= @completed_tasks.count %></h3>
        <p>Completed</p>
      </div>
      <div class="summary-card">
        <h3><%= @in_progress_tasks.count %></h3>
        <p>In Progress</p>
      </div>
      <div class="summary-card">
        <h3><%= @overdue_tasks.count %></h3>
        <p>Overdue</p>
      </div>
    </div>
  </div>

  <% if @overdue_tasks.any? %>
    <div class="overdue-section">
      <h2>‚ö†Ô∏è Overdue Tasks</h2>
      <div class="tasks-list">
        <% @overdue_tasks.each do |task| %>
          <div class="task-item overdue">
            <div class="task-info">
              <h4><%= link_to task.book.title, [task.book, task] %></h4>
              <p class="book-author">by <%= task.book.author %></p>
              <p class="target-date">Due: <%= task.target_date.strftime("%B %d, %Y") %></p>
            </div>
            <div class="task-status">
              <span class="badge badge-<%= task.status_color %>">
                <%= task.reading_status.humanize %>
              </span>
              <span class="badge badge-danger">Overdue</span>
            </div>
            <div class="task-actions">
              <%= link_to "View", [task.book, task], class: "btn btn-info btn-sm" %>
              <%= link_to "Edit", edit_book_task_path(task.book, task), class: "btn btn-warning btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="all-tasks-section">
    <h2>All Tasks</h2>
    <% if @tasks.any? %>
      <div class="tasks-list">
        <% @tasks.each do |task| %>
          <div class="task-item <%= 'overdue' if task.overdue? %>">
            <div class="task-info">
              <h4><%= link_to task.book.title, [task.book, task] %></h4>
              <p class="book-author">by <%= task.book.author %></p>
              <% if task.target_date.present? %>
                <p class="target-date">
                  <% if task.target_date < Date.current && task.reading_status != 'completed' %>
                    <span class="text-danger">Due: <%= task.target_date.strftime("%B %d, %Y") %></span>
                  <% else %>
                    Due: <%= task.target_date.strftime("%B %d, %Y") %>
                  <% end %>
                </p>
              <% end %>
              <% if task.chapter_summary.present? %>
                <p class="task-summary"><%= truncate(task.chapter_summary, length: 100) %></p>
              <% end %>
            </div>
            <div class="task-status">
              <span class="badge badge-<%= task.status_color %>">
                <%= task.reading_status.humanize %>
              </span>
              <% if task.overdue? %>
                <span class="badge badge-danger">Overdue</span>
              <% end %>
            </div>
            <div class="task-actions">
              <%= link_to "View", [task.book, task], class: "btn btn-info btn-sm" %>
              <%= link_to "Edit", edit_book_task_path(task.book, task), class: "btn btn-warning btn-sm" %>
              <%= link_to "Delete", [task.book, task], method: :delete, 
                  data: { confirm: "Are you sure?" }, class: "btn btn-danger btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <h3>No reading tasks yet!</h3>
        <p>Create some books first, then add tasks to track your reading progress.</p>
        <%= link_to "Go to Library", books_path, class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>